<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Dried Sweet Violets â€“ Viola odorata</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
:root{
  --panel:#fff; --ink:#111; --line:#ccc;
}
html.dark{
  --panel:#181a1f; --ink:#e2e2e2; --line:#444;
}
body{font-family:sans-serif;margin:0;padding:0;line-height:1.5;}
.section-title{font-size:1.2rem;margin-bottom:.5rem;}
.btn{
  background:#111;color:#fff;border:none;padding:.6rem 1.2rem;
  border-radius:8px;cursor:pointer;
}
.btn.secondary{background:#999;}
.small{font-size:.85rem;}
/* Modal shared for payment + newsletter */
#emailModal, #newsletterModal{
  position:fixed; inset:0; display:none; z-index:1200;
  align-items:center; justify-content:center; padding:16px;
  background:rgba(0,0,0,.55); backdrop-filter:blur(4px);
}
html.dark #emailModal, html.dark #newsletterModal{ background:rgba(0,0,0,.65); }
.modal-card{
  width:min(560px, 92vw); background:var(--panel); color:var(--ink);
  border:1px solid var(--line); border-radius:14px; padding:16px;
  box-shadow:0 10px 30px rgba(0,0,0,.25);
}
.modal-actions{ display:flex; gap:.6rem; justify-content:flex-end; margin-top:.9rem; }
.input{ width:100%; padding:.7rem; border:1px solid var(--line); border-radius:10px; background:#fff; }
html.dark .input{ background:#0f1014; color:var(--ink); }
label.small{ display:block; margin-top:.6rem; }
#emailThanks, #newsletterThanksInline{ display:none; color:#16a34a; margin-top:.4rem; }
</style>
</head>
<body>

<main style="padding:1rem;">
  <h1 class="section-title">Dried Sweet Violets â€“ Viola odorata</h1>
  <p>Fragrant, carefully dried sweet violet flowers.</p>

  <label for="sizeSelect">Select size</label>
  <select id="sizeSelect" onchange="updatePrice()" class="input">
    <option value="5">5 g</option>
    <option value="10">10 g</option>
    <option value="25">25 g</option>
    <option value="100">100 g</option>
  </select>
  <p id="totalPrice">5 g â€“ 125 SEK</p>

  <button onclick="openEmailCapture()" class="btn">Send payment link</button>
</main>

<footer style="padding:1rem; background:#f3f3f3;">
  <p>Sign up for our newsletter to get updates and special offers.</p>
  <input id="newsletterEmail" type="email" class="input" placeholder="your@email.com" style="max-width:250px;">
  <button type="button" class="btn" onclick="openNewsletterModal()">Subscribe</button>
  <p id="newsletterThanks" style="display:none; color:green; margin-top:.4rem;">Thank you! Check your inbox for confirmation.</p>
</footer>

<!-- Payment modal -->
<div id="emailModal" aria-hidden="true" role="dialog" aria-labelledby="emailTitle" aria-modal="true">
  <div class="modal-card" role="document">
    <h3 id="emailTitle" class="section-title" style="margin:.2rem 0 .4rem">Weâ€™ll send the payment link to your email</h3>
    <p class="small">Fill in your details and weâ€™ll send you a unique payment link (Revolut) along with the order summary.</p>

    <label class="small" for="fullName">Name</label>
    <input id="fullName" type="text" class="input" placeholder="Full name">

    <label class="small" for="emailInput">Email address</label>
    <input id="emailInput" type="email" class="input" placeholder="name@example.com">

    <label class="small" for="addr1">Address</label>
    <input id="addr1" type="text" class="input" placeholder="Street and number">
    <input id="addr2" type="text" class="input" placeholder="Apt, c/o (optional)" style="margin-top:.4rem">

    <div style="display:flex; gap:.6rem; margin-top:.6rem">
      <input id="postal" type="text" class="input" placeholder="ZIP" style="flex:0 0 120px">
      <input id="city" type="text" class="input" placeholder="City" style="flex:1">
    </div>

    <label class="small" for="country">Country</label>
    <input id="country" type="text" class="input" value="Sweden">

    <div class="modal-actions">
      <button onclick="closeEmailCapture()" class="btn secondary">Cancel</button>
      <button onclick="submitOrder()" class="btn">Send</button>
    </div>
    <p id="emailThanks">Thank you! Youâ€™ll get an email with a payment link shortly. ðŸ’Œ</p>
  </div>
</div>

<!-- Newsletter modal -->
<div id="newsletterModal" aria-hidden="true" role="dialog" aria-labelledby="nlTitle" aria-modal="true">
  <div class="modal-card" role="document">
    <h3 id="nlTitle" class="section-title" style="margin:.2rem 0 .4rem">Subscribe to our newsletter</h3>
    <p class="small">We only send emails when we have something truly worth sharing.</p>

    <label class="small" for="nlName">Name (optional)</label>
    <input id="nlName" type="text" class="input" placeholder="Full name">

    <label class="small" for="nlEmail">Email address</label>
    <input id="nlEmail" type="email" class="input" placeholder="name@example.com">

    <label class="small" style="display:flex; gap:.5rem; align-items:flex-start; margin-top:.6rem;">
      <input id="nlConsent" type="checkbox" style="margin-top:.3rem">
      <span>I agree to receive newsletters. I can unsubscribe at any time.</span>
    </label>

    <div class="modal-actions">
      <button type="button" class="btn secondary" onclick="closeNewsletterModal()">Cancel</button>
      <button type="button" class="btn" onclick="submitNewsletter()">Subscribe</button>
    </div>
    <p id="newsletterThanksInline">Thank you! Please check your email for confirmation. ðŸ’Œ</p>
  </div>
</div>

<script>
const prices = {5:125, 10:250, 25:600, 100:2000};
function updatePrice(){
  const g = document.getElementById('sizeSelect').value;
  document.getElementById('totalPrice').textContent = `${g} g â€“ ${prices[g]} SEK`;
}
function openNewsletterModal(){
  const m = document.getElementById('newsletterModal');
  const pageEmail = document.getElementById('newsletterEmail')?.value?.trim();
  if(pageEmail) document.getElementById('nlEmail').value = pageEmail;
  m.style.display = 'flex';
  m.setAttribute('aria-hidden','false');
  setTimeout(()=>document.getElementById('nlEmail').focus(), 50);
}
function closeNewsletterModal(){
  const m = document.getElementById('newsletterModal');
  m.style.display = 'none';
  m.setAttribute('aria-hidden','true');
}
async function submitNewsletter(){
  const name = document.getElementById('nlName').value.trim();
  const email = document.getElementById('nlEmail').value.trim();
  const consent = document.getElementById('nlConsent').checked;
  if(!email || !/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(email)){
    alert('Please enter a valid email address.'); return;
  }
  if(!consent){
    alert('Please agree to receive the newsletter.'); return;
  }
  document.getElementById('newsletterThanksInline').style.display = 'block';
  setTimeout(()=>{ closeNewsletterModal(); }, 1400);
  const thanks = document.getElementById('newsletterThanks');
  if (thanks) { thanks.style.display='block'; setTimeout(()=>{ thanks.style.display='none'; }, 2000); }
}
function openEmailCapture(){
  const m = document.getElementById('emailModal');
  m.style.display='flex'; m.setAttribute('aria-hidden','false');
  document.getElementById('emailThanks').style.display='none';
  setTimeout(()=>document.getElementById('fullName').focus(),50);
}
function closeEmailCapture(){
  const m = document.getElementById('emailModal');
  m.style.display='none'; m.setAttribute('aria-hidden','true');
}
async function submitOrder(){
  const grams = document.getElementById('sizeSelect').value;
  const price = prices[grams];
  const fullName = document.getElementById('fullName').value.trim();
  const email = document.getElementById('emailInput').value.trim();
  const addr1 = document.getElementById('addr1').value.trim();
  const addr2 = document.getElementById('addr2').value.trim();
  const postal = document.getElementById('postal').value.trim();
  const city = document.getElementById('city').value.trim();
  const country = document.getElementById('country').value.trim();
  if(!fullName || !email || !addr1 || !postal || !city || !country){
    alert('Please fill in name, email, and full address.'); return;
  }
  if(!/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(email)){
    alert('Please enter a valid email address.'); return;
  }
  const shippingMethod = 'SE_tracked_49';
  const payload = {
    product_sku:"AB00439",
    product_name:"Dried Sweet Violets â€“ Viola odorata",
    grams:Number(grams),
    price_sek:Number(price),
    language:"en",
    shipping_method:shippingMethod,
    full_name:fullName, email, address1:addr1, address2:addr2, postal, city, country
  };
  try{
    await fetch("YOUR_APPS_SCRIPT_WEBAPP_URL", {
      method:"POST", mode:"no-cors",
      headers:{ "Content-Type":"application/json" },
      body:JSON.stringify(payload)
    });
    document.getElementById('emailThanks').style.display='block';
    setTimeout(()=>{ closeEmailCapture(); }, 1400);
  }catch(e){ alert('Something went wrong. Please try again.'); }
}
['emailModal','newsletterModal'].forEach(id=>{
  const el = document.getElementById(id);
  el?.addEventListener('click', (e)=>{ if(e.target.id===id) (id==='emailModal'?closeEmailCapture():closeNewsletterModal)(); });
});
document.addEventListener('keydown', (e)=>{
  if(e.key==='Escape'){
    if(document.getElementById('emailModal').style.display==='flex') closeEmailCapture();
    if(document.getElementById('newsletterModal').style.display==='flex') closeNewsletterModal();
  }
});
</script>

</body>
</html>

